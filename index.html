<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ÊôÇÁµ¶„Éô„Éº„ÇπÂèéÂÖ•ÁÆ°ÁêÜ„Ç¢„Éó„É™</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Hiragino Sans', 'Yu Gothic UI', sans-serif;
            background: linear-gradient(135deg, #ffeef5 0%, #f8d7da 50%, #ffb3c6 100%);
            min-height: 100vh;
            padding: 8px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(255, 182, 193, 0.18);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ffb3c6 0%, #ff9aa2 100%);
            color: white;
            padding: 18px 8px;
            text-align: center;
        }

        h1 {
            font-size: 1.5em;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .subtitle {
            opacity: 0.9;
            font-size: 1em;
        }

        .main-content {
            padding: 12px 6px;
        }

        .settings-section {
            background: #fef7f7;
            padding: 12px 8px;
            border-radius: 12px;
            margin-bottom: 18px;
            border: 1.5px solid #ffb3c6;
        }

        .settings-row {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: stretch;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 6px;
            color: #d63384;
            font-weight: 600;
            font-size: 1em;
        }

        input[type="number"] {
            width: 100%;
            padding: 10px 12px;
            border: 1.5px solid #ffb3c6;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #ff9aa2;
            box-shadow: 0 0 0 2px rgba(255, 179, 198, 0.18);
        }

        .monthly-section {
            margin-bottom: 18px;
        }

        .month-card {
            background: white;
            border: 1.5px solid #ffb3c6;
            border-radius: 12px;
            padding: 12px 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .month-card:hover {
            box-shadow: 0 4px 12px rgba(255, 179, 198, 0.10);
            transform: translateY(-1px);
        }

        .month-header {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 1px solid #fef7f7;
        }

        .month-title {
            font-size: 1.1em;
            font-weight: 700;
            color: #d63384;
        }

        .month-summary {
            text-align: left;
            font-size: 0.95em;
        }

        .total-amount {
            color: #d63384;
            font-weight: 700;
            font-size: 1em;
        }

        .remaining-amount {
            color: #28a745;
            font-weight: 600;
            font-size: 0.95em;
        }

        .remaining-amount.warning {
            color: #ffc107;
        }

        .remaining-amount.danger {
            color: #dc3545;
        }

        .month-inputs {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .summary-section {
            background: linear-gradient(135deg, #fef7f7 0%, #ffb3c6 100%);
            padding: 12px 8px;
            border-radius: 12px;
            margin-bottom: 12px;
            text-align: center;
        }

        .summary-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 10px;
        }

        .summary-item {
            background: white;
            padding: 10px 8px;
            border-radius: 8px;
            border: 1.5px solid #ffb3c6;
        }

        .summary-label {
            font-size: 0.95em;
            color: #d63384;
            margin-bottom: 3px;
        }

        .summary-value {
            font-size: 1.2em;
            font-weight: 700;
            color: #333;
        }

        .progress-container {
            margin: 10px 0;
        }

        .progress-bar {
            width: 100%;
            height: 18px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            border: 1.5px solid #ffb3c6;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffb3c6, #ff9aa2);
            border-radius: 8px;
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.85em;
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #ffc107, #fd7e14);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, #dc3545, #c82333);
        }

        .button-container {
            text-align: center;
            margin-top: 18px;
        }

        .btn-summary {
            background: linear-gradient(135deg, #ffb3c6 0%, #ff9aa2 100%);
            color: white;
            padding: 12px 28px;
            border: none;
            border-radius: 32px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(255, 179, 198, 0.22);
        }

        .btn-summary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 18px rgba(255, 179, 198, 0.28);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 0;
            border-radius: 16px;
            width: 98vw;
            max-width: 98vw;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #ffb3c6 0%, #ff9aa2 100%);
            color: white;
            padding: 16px 8px;
            text-align: center;
            border-radius: 16px 16px 0 0;
        }

        .modal-body {
            padding: 12px 8px;
        }

        .close {
            color: white;
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0.8;
        }

        .close:hover {
            opacity: 1;
        }

        .chart-container {
            width: 100%;
            height: 220px;
            margin: 10px 0;
        }

        .monthly-data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 3px rgba(255, 179, 198, 0.08);
            font-size: 0.95em;
        }

        .monthly-data-table th,
        .monthly-data-table td {
            padding: 8px 4px;
            text-align: center;
            border-bottom: 1px solid #f8f9fa;
        }

        .monthly-data-table th {
            background: #ffb3c6;
            color: white;
            font-weight: 600;
        }

        .monthly-data-table tr:hover {
            background: #fef7f7;
        }

        /* „Çπ„Éû„ÉõÂêë„ÅëÊúÄÈÅ©Âåñ */
        @media (max-width: 600px) {
            body {
                padding: 2px;
            }

            .container {
                border-radius: 8px;
                box-shadow: none;
            }

            .header {
                padding: 10px 2px;
            }

            h1 {
                font-size: 1.1em;
            }

            .main-content {
                padding: 4px 2px;
            }

            .settings-section,
            .summary-section,
            .month-card,
            .modal-content,
            .modal-header,
            .modal-body {
                padding: 6px 2px !important;
                border-radius: 8px !important;
            }

            .summary-grid,
            .settings-row,
            .month-inputs {
                gap: 6px !important;
            }

            .btn-summary {
                padding: 8px 16px;
                font-size: 1em;
            }

            .chart-container {
                height: 140px;
            }

            .monthly-data-table th,
            .monthly-data-table td {
                padding: 4px 2px;
                font-size: 0.85em;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ ÊôÇÁµ¶„Éô„Éº„ÇπÂèéÂÖ•ÁÆ°ÁêÜ</h1>
            <div class="subtitle">130‰∏áÂÜÜ„ÅÆÂ£Å„Çí„Çπ„Éû„Éº„Éà„Å´ÁÆ°ÁêÜ</div>
        </div>

        <div class="main-content">
            <!-- Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="settings-section">
                <div class="settings-row">
                    <div class="form-group">
                        <label for="hourlyWage">ÊôÇÁµ¶ÔºàÂÜÜÔºâ</label>
                        <input type="number" id="hourlyWage" placeholder="1000" min="0">
                    </div>
                    <div class="form-group">
                        <label for="yearlyLimit">Âπ¥Âèé‰∏äÈôêÔºàÂÜÜÔºâ</label>
                        <input type="number" id="yearlyLimit" value="1300000" min="0">
                    </div>
                </div>
            </div>

            <!-- „Çµ„Éû„É™„Éº„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="summary-section">
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">Á∑èÂä¥ÂÉçÊôÇÈñì</div>
                        <div class="summary-value" id="totalHours">0ÊôÇÈñì</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Á®º„ÅÑ„Å†ÂêàË®à</div>
                        <div class="summary-value" id="totalEarned">¬•0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">ÊÆã„ÇäÁ®º„Åí„ÇãÈ°ç</div>
                        <div class="summary-value" id="remainingAmount">¬•1,300,000</div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%;">0%</div>
                    </div>
                </div>
            </div>

            <!-- ÊúàÂà•ÂÖ•Âäõ„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="monthly-section" id="monthlySection">
                <!-- ÊúàÂà•„Ç´„Éº„Éâ„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
            </div>

            <!-- ‰∏ÄË¶ß„Éú„Çø„É≥ -->
            <div class="button-container">
                <button class="btn-summary" onclick="showSummaryModal()">üìä Ë©≥Á¥∞‰∏ÄË¶ß„ÇíË°®Á§∫</button>
            </div>
        </div>
    </div>

    <!-- „Çµ„Éû„É™„Éº„É¢„Éº„ÉÄ„É´ -->
    <div id="summaryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeSummaryModal()">&times;</span>
                <h2>üìä Ë©≥Á¥∞„Çµ„Éû„É™„Éº</h2>
            </div>
            <div class="modal-body">
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">Á∑èÂä¥ÂÉçÊôÇÈñì</div>
                        <div class="summary-value" id="modalTotalHours">0ÊôÇÈñì</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Á∑èÂèéÂÖ•</div>
                        <div class="summary-value" id="modalTotalEarned">¬•0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Âπ≥ÂùáÊôÇÁµ¶</div>
                        <div class="summary-value" id="modalAverageWage">¬•0</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="incomeChart"></canvas>
                </div>

                <table class="monthly-data-table">
                    <thead>
                        <tr>
                            <th>Êúà</th>
                            <th>Âä¥ÂÉçÊôÇÈñì</th>
                            <th>ÁâπÂà•ÊâãÂΩì</th>
                            <th>ÊúàÂèé</th>
                            <th>Á¥ØË®à</th>
                        </tr>
                    </thead>
                    <tbody id="monthlyDataTable">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        let monthlyData = {};
        let chartInstance = null;

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function () {
            initializeApp();
            loadData();
            generateMonthlyCards();
            updateSummary();
        });

        function initializeApp() {
            // ÁèæÂú®„ÅÆÂπ¥Â∫¶„ÅÆÊúà„ÇíÁîüÊàêÔºà4Êúà„Çπ„Çø„Éº„Éà„ÄÅ3ÊúàÁµÇ„Çè„ÇäÔºâ
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1;

            // Âπ¥Â∫¶„ÇíÊ±∫ÂÆöÔºà4Êúà‰ª•Èôç„Å™„ÇâÂΩìÂπ¥Â∫¶„ÄÅ3Êúà‰ª•Ââç„Å™„ÇâÂâçÂπ¥Â∫¶ÈñãÂßãÔºâ
            const fiscalYear = currentMonth >= 4 ? currentYear : currentYear - 1;

            // 4Êúà„Åã„ÇâÁøåÂπ¥3Êúà„Åæ„Åß
            for (let i = 0; i < 12; i++) {
                const month = ((i + 4 - 1) % 12) + 1; // 4Êúà„Åã„ÇâÈñãÂßã
                const year = month >= 4 ? fiscalYear : fiscalYear + 1;
                const monthKey = `${year}-${month.toString().padStart(2, '0')}`;

                if (!monthlyData[monthKey]) {
                    monthlyData[monthKey] = {
                        hours: 0,
                        bonus: 0,
                        totalEarned: 0
                    };
                }
            }
        }

        function generateMonthlyCards() {
            const monthlySection = document.getElementById('monthlySection');
            monthlySection.innerHTML = '';

            // 4Êúà„Çπ„Çø„Éº„Éà„ÅÆÊúàÈ†ÜÂ∫è
            const monthsInOrder = ['4Êúà', '5Êúà', '6Êúà', '7Êúà', '8Êúà', '9Êúà',
                '10Êúà', '11Êúà', '12Êúà', '1Êúà', '2Êúà', '3Êúà'];

            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1;

            // Âπ¥Â∫¶„ÇíÊ±∫ÂÆö
            const fiscalYear = currentMonth >= 4 ? currentYear : currentYear - 1;

            monthsInOrder.forEach((monthName, index) => {
                const monthNum = ((index + 4 - 1) % 12) + 1; // 4Êúà„Åã„ÇâÈñãÂßã
                const year = monthNum >= 4 ? fiscalYear : fiscalYear + 1;
                const monthKey = `${year}-${monthNum.toString().padStart(2, '0')}`;
                const data = monthlyData[monthKey] || { hours: 0, bonus: 0, totalEarned: 0 };

                const monthCard = document.createElement('div');
                monthCard.className = 'month-card';
                monthCard.innerHTML = `
                    <div class="month-header">
                        <div class="month-title">${monthName} (${year}Âπ¥)</div>
                        <div class="month-summary">
                            <div class="total-amount">ÊúàÂèé: ¬•${data.totalEarned.toLocaleString()}</div>
                            <div class="remaining-amount" id="remaining-${monthKey}">ÊÆã„Çä: ¬•${calculateRemaining().toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="month-inputs">
                        <div class="form-group">
                            <label for="hours-${monthKey}">Âä¥ÂÉçÊôÇÈñì</label>
                            <input type="number" id="hours-${monthKey}" value="${data.hours}" 
                                   placeholder="0" min="0" step="0.5" 
                                   onchange="updateMonthlyData('${monthKey}')">
                        </div>
                        <div class="form-group">
                            <label for="bonus-${monthKey}">ÁâπÂà•ÊâãÂΩìÔºàÂÜÜÔºâ</label>
                            <input type="number" id="bonus-${monthKey}" value="${data.bonus}" 
                                   placeholder="0" min="0" 
                                   onchange="updateMonthlyData('${monthKey}')">
                        </div>
                    </div>
                `;
                monthlySection.appendChild(monthCard);
            });
        }

        function updateMonthlyData(monthKey) {
            const hours = parseFloat(document.getElementById(`hours-${monthKey}`).value) || 0;
            const bonus = parseFloat(document.getElementById(`bonus-${monthKey}`).value) || 0;
            const hourlyWage = parseFloat(document.getElementById('hourlyWage').value) || 0;

            const wageEarned = hours * hourlyWage;
            const totalEarned = wageEarned + bonus;

            monthlyData[monthKey] = {
                hours: hours,
                bonus: bonus,
                totalEarned: totalEarned
            };

            // ÊúàÂèéË°®Á§∫„ÇíÊõ¥Êñ∞
            const monthCard = document.querySelector(`#hours-${monthKey}`).closest('.month-card');
            const totalAmountEl = monthCard.querySelector('.total-amount');
            totalAmountEl.textContent = `ÊúàÂèé: ¬•${totalEarned.toLocaleString()}`;

            updateSummary();
            saveData();
        }

        function updateSummary() {
            const yearlyLimit = parseFloat(document.getElementById('yearlyLimit').value) || 1300000;

            let totalHours = 0;
            let totalEarned = 0;

            Object.values(monthlyData).forEach(data => {
                totalHours += data.hours;
                totalEarned += data.totalEarned;
            });

            const remaining = Math.max(0, yearlyLimit - totalEarned);
            const progressPercentage = Math.min(100, (totalEarned / yearlyLimit) * 100);

            // „Çµ„Éû„É™„ÉºË°®Á§∫„ÇíÊõ¥Êñ∞
            document.getElementById('totalHours').textContent = `${totalHours.toFixed(1)}ÊôÇÈñì`;
            document.getElementById('totalEarned').textContent = `¬•${totalEarned.toLocaleString()}`;
            document.getElementById('remainingAmount').textContent = `¬•${remaining.toLocaleString()}`;

            // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÇíÊõ¥Êñ∞
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = progressPercentage + '%';
            progressFill.textContent = progressPercentage.toFixed(1) + '%';

            // Ëâ≤„ÇíÊõ¥Êñ∞
            progressFill.className = 'progress-fill';
            if (progressPercentage >= 100) {
                progressFill.classList.add('danger');
            } else if (progressPercentage >= 90) {
                progressFill.classList.add('warning');
            }

            // ÂêÑÊúà„ÅÆÊÆã„ÇäË°®Á§∫„ÇíÊõ¥Êñ∞
            Object.keys(monthlyData).forEach(monthKey => {
                const remainingEl = document.getElementById(`remaining-${monthKey}`);
                if (remainingEl) {
                    remainingEl.textContent = `ÊÆã„Çä: ¬•${remaining.toLocaleString()}`;
                    remainingEl.className = 'remaining-amount';
                    if (remaining <= 0) {
                        remainingEl.classList.add('danger');
                    } else if (remaining < yearlyLimit * 0.1) {
                        remainingEl.classList.add('warning');
                    }
                }
            });
        }

        function calculateRemaining() {
            const yearlyLimit = parseFloat(document.getElementById('yearlyLimit').value) || 1300000;
            const totalEarned = Object.values(monthlyData).reduce((sum, data) => sum + data.totalEarned, 0);
            return Math.max(0, yearlyLimit - totalEarned);
        }

        function showSummaryModal() {
            updateModalContent();
            document.getElementById('summaryModal').style.display = 'block';
        }

        function closeSummaryModal() {
            document.getElementById('summaryModal').style.display = 'none';
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
        }

        function updateModalContent() {
            let totalHours = 0;
            let totalEarned = 0;

            Object.values(monthlyData).forEach(data => {
                totalHours += data.hours;
                totalEarned += data.totalEarned;
            });

            const averageWage = totalHours > 0 ? (totalEarned - Object.values(monthlyData).reduce((sum, data) => sum + data.bonus, 0)) / totalHours : 0;

            document.getElementById('modalTotalHours').textContent = `${totalHours.toFixed(1)}ÊôÇÈñì`;
            document.getElementById('modalTotalEarned').textContent = `¬•${totalEarned.toLocaleString()}`;
            document.getElementById('modalAverageWage').textContent = `¬•${averageWage.toFixed(0)}`;

            updateChart();
            updateDataTable();
        }

        function updateChart() {
            const ctx = document.getElementById('incomeChart').getContext('2d');

            if (chartInstance) {
                chartInstance.destroy();
            }

            // 4Êúà„Çπ„Çø„Éº„Éà„ÅÆÊúàÈ†ÜÂ∫è
            const monthsInOrder = ['4Êúà', '5Êúà', '6Êúà', '7Êúà', '8Êúà', '9Êúà',
                '10Êúà', '11Êúà', '12Êúà', '1Êúà', '2Êúà', '3Êúà'];
            const monthlyEarnings = [];
            const cumulativeEarnings = [];
            let cumulative = 0;

            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1;
            const fiscalYear = currentMonth >= 4 ? currentYear : currentYear - 1;

            for (let i = 0; i < 12; i++) {
                const monthNum = ((i + 4 - 1) % 12) + 1; // 4Êúà„Åã„ÇâÈñãÂßã
                const year = monthNum >= 4 ? fiscalYear : fiscalYear + 1;
                const monthKey = `${year}-${monthNum.toString().padStart(2, '0')}`;
                const data = monthlyData[monthKey] || { totalEarned: 0 };
                monthlyEarnings.push(data.totalEarned);
                cumulative += data.totalEarned;
                cumulativeEarnings.push(cumulative);
            }

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthsInOrder,
                    datasets: [{
                        label: 'ÊúàÂèé',
                        data: monthlyEarnings,
                        borderColor: '#ffb3c6',
                        backgroundColor: 'rgba(255, 179, 198, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Á¥ØË®àÂèéÂÖ•',
                        data: cumulativeEarnings,
                        borderColor: '#ff9aa2',
                        backgroundColor: 'rgba(255, 154, 162, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Âπ¥Â∫¶Âà•ÂèéÂÖ•Êé®ÁßªÔºà4Êúà„Äú3ÊúàÔºâ',
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: '#d63384'
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'ÊúàÂèéÔºàÂÜÜÔºâ',
                                color: '#d63384'
                            },
                            ticks: {
                                callback: function (value) {
                                    return '¬•' + value.toLocaleString();
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Á¥ØË®àÂèéÂÖ•ÔºàÂÜÜÔºâ',
                                color: '#d63384'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                callback: function (value) {
                                    return '¬•' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateDataTable() {
            const tableBody = document.getElementById('monthlyDataTable');
            tableBody.innerHTML = '';

            // 4Êúà„Çπ„Çø„Éº„Éà„ÅÆÊúàÈ†ÜÂ∫è
            const monthsInOrder = ['4Êúà', '5Êúà', '6Êúà', '7Êúà', '8Êúà', '9Êúà',
                '10Êúà', '11Êúà', '12Êúà', '1Êúà', '2Êúà', '3Êúà'];

            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1;
            const fiscalYear = currentMonth >= 4 ? currentYear : currentYear - 1;

            let cumulative = 0;

            monthsInOrder.forEach((monthName, index) => {
                const monthNum = ((index + 4 - 1) % 12) + 1; // 4Êúà„Åã„ÇâÈñãÂßã
                const year = monthNum >= 4 ? fiscalYear : fiscalYear + 1;
                const monthKey = `${year}-${monthNum.toString().padStart(2, '0')}`;
                const data = monthlyData[monthKey] || { hours: 0, bonus: 0, totalEarned: 0 };
                cumulative += data.totalEarned;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${monthName}</td>
                    <td>${data.hours.toFixed(1)}ÊôÇÈñì</td>
                    <td>¬•${data.bonus.toLocaleString()}</td>
                    <td>¬•${data.totalEarned.toLocaleString()}</td>
                    <td>¬•${cumulative.toLocaleString()}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function saveData() {
            const data = {
                monthlyData: monthlyData,
                settings: {
                    hourlyWage: document.getElementById('hourlyWage').value,
                    yearlyLimit: document.getElementById('yearlyLimit').value
                }
            };
            // „É°„É¢„É™„Å´‰øùÂ≠òÔºàÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Åß„ÅØlocalStorage„Çí‰ΩøÁî®ÂèØËÉΩÔºâ
            window.appData = data;
        }

        function loadData() {
            // „É°„É¢„É™„Åã„ÇâË™≠„ÅøËæº„ÅøÔºàÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Åß„ÅØlocalStorage„Åã„ÇâË™≠„ÅøËæº„ÅøÂèØËÉΩÔºâ
            if (window.appData) {
                const data = window.appData;
                monthlyData = data.monthlyData || {};
                if (data.settings) {
                    document.getElementById('hourlyWage').value = data.settings.hourlyWage || '';
                    document.getElementById('yearlyLimit').value = data.settings.yearlyLimit || '1300000';
                }
            }
        }

        // Ë®≠ÂÆöÂ§âÊõ¥ÊôÇ„ÅÆÂá¶ÁêÜ
        document.getElementById('hourlyWage').addEventListener('change', function () {
            // ÂÖ®„Å¶„ÅÆÊúà„ÅÆ„Éá„Éº„Çø„ÇíÂÜçË®àÁÆó
            Object.keys(monthlyData).forEach(monthKey => {
                updateMonthlyData(monthKey);
            });
        });

        document.getElementById('yearlyLimit').addEventListener('change', function () {
            updateSummary();
            saveData();
        });

        // „É¢„Éº„ÉÄ„É´„ÅÆÂ§ñÂÅ¥„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        window.onclick = function (event) {
            const modal = document.getElementById('summaryModal');
            if (event.target === modal) {
                closeSummaryModal();
            }
        }
    </script>
</body>

</html>
